apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: app-back-production
  annotations:
    run.googleapis.com/ingress: all
spec:
  template:
    metadata:
      annotations:
        run.googleapis.com/cpu-throttling: 'false'
        run.googleapis.com/startup-cpu-boost: 'true'
        run.googleapis.com/vpc-access-connector: projects/tfg-production/locations/europe-west9/connectors/cloud-run-vpc-connector
    spec:
      containerConcurrency: 80
      # TODO: 300sec is only there for the sync bubble call, decrsease tihs to 10sec
      # when done with bubble
      timeoutSeconds: 300
      containers:
      - image: europe-west9-docker.pkg.dev/tfg-production/traceforgood/app-back:#DOCKER_IMAGE_TAG#
        ports:
        - name: http1
          containerPort: 8000
        env:
        - name: PORT
          value: 8000
        - name: BASE_APP_URL
          value: https://app.v2.traceforgood.com
        resources:
          limits:
            memory: 1024Mi
            cpu: 1000m
